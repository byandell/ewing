---
title: "ewing"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{ewing}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.heigth = 9,
  fig.width = 8.5
)
```

```{r setup}
library(ewing)
```

## Modular approach 

This was developed 18 Nov 2002 and updated 10 Aug 2022.

A big change is that I have modularized things. The default species are now 
"host" and "parasite". There is a second library called "[redscale](https://github.com/byandell/redscale)" that 
has redscale and aphytis and comperiella and encarsia. (Actually, host is 
just redscale, and parasite is just aphytis). Now you can set up a new 
system by just creating a new library package.

The second big change is that I use R conventions of passing arguments, 
rather than hiding things as I have done in the past. Now you do

```{r}
mysim <- init.simulation(interact = FALSE)
```

```{r}
simres <- future.events(mysim, refresh = 1000, plotit = TRUE)
```

```{r}
simres <- future.events(mysim, plotit = FALSE)
```

```{r}
ggplot_ewing(simres)
```

```{r}
ggplot_ewing(simres, total = FALSE, normalize = FALSE)
```

```{r}
ggplot_ewing(simres, normalize = FALSE, substrate = FALSE)
```

```{r}
plot(simres)
```

```{r}
plot(simres, substrate = FALSE)
```

The object "mysim" has the initial populations and the organism and 
temperature structures. The object "simres" has the populations after 
running future.events (used to be step.future), along with summary 
information from the run.

I have also modularized the immediate, pending and future events. The functions

	event.birth	birth immediate event
	event.attack	attack immediate event
	event.death	death pending event
	event.future	generic future event

You can supply your own version of these if you don't like mine. And you 
can add new ones by making appropriate changes in the "event" column of the 
future.host and future.parasite column. Adding a new kind of event, such as 
migrate means the routine now looks for a routine called "event.migrate".
Also, event.attack uses the type of parasite (endo,ecto) and the actual 
event (feed,ovip) to look for routines like event.ecto.feed to process 
attack details.

## Multiple Simulation Runs

```{r}
data(simdata)
```

```{r}
summary(simdata)
```

```{r}
ggplot_ewing_envelopes(simdata)
```

```{r}
ggplot_ewing_envelopes(simdata, confidence = TRUE)
```

## Other plots

```{r}
plot_current(simres, "host")
text_current(simres, "host")
```

```{r}
plot_current(simres, "parasite")
text_current(simres, "parasite")
```

The following plot is supposed to break out by substrate, which is in `sub.stage` in the `community` object (`simres`). But the way it is saved right now makes this goofy somehow.
Changing should be done carefully as this is used in multiple places. For now just leave it.
Note also that the color and text should correspond but not into the legend as I need
to formally assign the colors in a more intuitive way a la ggplot2. Later.

Need an explanation of single letter codes (say from future.host)

```{r}
ggplot_current(simres, "host")
```

Interactive plots showing splines. Use `graphics::locator()`.

```{r eval=FALSE}
five.plot()
```

```{r eval=FALSE}
five.show()
```

Plot to relate day to degree-day based on temperature regime.

```{r}
temp.plot(simres)
```

interactive design plot for high and low temperatures. Uses `graphics::locator()`.

```{r eval=FALSE}
temp.design(simres)
```

## Another attempt

Some of the data are stored in different ways, and it will take me awhile to 
sort out what is going on. For now stick to the above script.

One begins a simulation by initializing a species. At present, this is done by setting up a space- or tab-delimited file with various fields. Each row represents a stage in the Red Scale's life, although the first two rows are dummies for parasitization for now. The fields are mostly self-explanatory. DD represents mean degree days to that future event. Thus the mean time to "virgin" from "third.3" is 560-465=95 DD. The next two fields concern the Aphytis parasite, comprising the relative risk of being killed by an Aphytis that is feeding or is laying eggs, respectively. There was no explicit information on feeding risk, so these are made up following Luck's papers. The egg-laying risks are directly from the IPM pamphlet. The next two fields have the relative risks for the other two parasites. Then follows the gender (only females modeled here). The next field has the plotting symbol (pch), followed by the plotting color. The last and most important column is the life stage.

```
data(redscale)
```

```
redscale.run <- init.population(redscale, 200)
```
